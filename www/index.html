<!DOCTYPE html>
<html>
<head>
<title>InPhO Corpus Builder</title>
<script src="lib/jquery-1.11.0.min.js"></script>
<!--<script src="lib/jquery.superdom.min.js"></script>-->
<script src="lib/bootstrap-2.3.2/js/bootstrap.min.js"></script>
<script src="lib/d3.v3.min.js"></script>
<script src="lib/mustache.js"></script>
<script src="lib/inpho/util.js"></script>
<!--<script src="sep.js"></script>-->
<link rel="stylesheet" type="text/css" href="lib/bootstrap-2.3.2/css/bootstrap.min.css" />
<style>
.logo-word {
  background-image: url('/img/inpho_logo.png');
  background-size: 172px 92px;
  width: 172px;
  height: 84px;
  padding-top: 6px;
  margin-top: 14px;
  margin-bottom: 5px;
  margin-left: -6px;
  display: inline-block;
  text-indent: -3000px;
}
h1 {
text-align: center;
margin-bottom: 0;
font-size: 59px;
line-height: 1;
color: inherit;
letter-spacing: -1px;

}

.btn {
  vertical-align: middle;
  margin-top: 0;
}

#duplicates li:first-child {
  font-weight: bold;
}
#duplicates .error li:first-child {
  font-weight: normal;
}
#duplicates .success li {
  font-weight: bold;
}
.terms {
  font-style: italic;
}
.quant {
  font-style: bold;
  }
.propList {
  display: none;  
  width: 45%;
  float:left;
}
.error .propList {
  display: inline;
  width: 45%;
  float:left;
}
.htrcIdCol {
  width: 250px;
}
</style>
</head>

<body>
<div class="container">
  <div class="row">
  <div class="span12">
  <h1>Corpus Builder</h1>
  <h2>Darwin's Beagle Corpus</h2>
  <p>This page contains the corresponding HTRC entries for the beagle voyage</p> 
  <p><a href="http://github.com/inpho/corpus-builder/" target="_blank">Source code</a> and <a href="http://github.com/inpho/corpus-builder/issues/" target="_blank">issue tracking</a> for this page available at <a href="http://github.com/inpho/topic-explorer/" target="_blank">GitHub</a>. Contact Jaimie Murdock (<span class="iumail">jammurdo</span>) with further comments.</p>
  <script>var mail = $('.iumail').text();
  $('.iumail').html('<a href="mailto:'+mail+'@indiana.edu">'+mail+'@indiana.edu</a>')</script>
  </div>
  </div>

  <div class="row">
  <div class="span12">
    <ul class="inline" id="stats"></ul>
    <table class="table table-hover table-condensed" id="corpus">
      <tbody>
      </tbody>
    </table>
    <button class="btn btn-primary" onClick="gatherVolumes()">Select Volumes</button>
  </div>
  </div>
</div>
<script>

function gatherVolumes() {
  var volumes = [];
  $('#corpus tr').each(function(i,elt) {
    if ($(this).hasClass('success'))
      volumes.push($(this).data('htrcid'));
    });
  console.log(volumes);
  return volumes;
}

$.get("row.mustache.html", function(template) {
  $.getJSON('readings.json', function(data) {
    $('#stats').append('<li>'+data.length+' records</li>');
    $('#stats').append('<li>'+data.filter(function(item) { return item.htrc_id == null }).length+' missing</li>');

    for (i = 0; i < data.length; i++) {
      data[i]['htrc_props'] = []
      for (var prop in data[i]['htrc_md']){
        if (data[i]['htrc_md'].hasOwnProperty(prop)){
          data[i]['htrc_props'].push({
            'key' : prop,
            'value' : data[i]['htrc_md'][prop]
           });
        }
      }

      data[i]['citation_props'] = []
      for (var prop in data[i]['parsed']){
        if (data[i]['parsed'].hasOwnProperty(prop)){
          data[i]['citation_props'].push({
            'key' : prop,
            'value' : data[i]['parsed'][prop]
           });
        }
      }

      var html = Mustache.to_html(template, data[i]);
      $('tbody').append(html);
    }

    $('#corpus tr').click(function() {
      console.log("CLICK");
      if ($(this).hasClass('success')) {
        $(this).removeClass('success');
      } else if ($(this).hasClass('error')) {
        $(this).removeClass('error');
        $(this).addClass('success');
      } else {
        $(this).addClass('error');
      }
    });

    $('.htrcLink').tooltip({text: 'View  Volume at HTRC', placement: 'bottom'});
  });

});

</script>
</body>
</html>
